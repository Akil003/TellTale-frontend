(this.webpackJsonpnetflix_clone=this.webpackJsonpnetflix_clone||[]).push([[0],{100:function(e,t,n){},103:function(e,t,n){},104:function(e,t,n){},105:function(e,t,n){},115:function(e,t,n){},116:function(e,t,n){"use strict";n.r(t);var a=n(3),c=n.n(a),r=n(45),s=n.n(r),o=(n(71),n(72),n(1)),i=n(13),l=n(37),u=n.n(l),j=u.a.create({baseURL:"https://telltale-backend-0tqm.onrender.com/"}),d=(n(92),n(93),n(118)),b=n(2);function O(e){var t=e.parentClass,n=e.message;return Object(b.jsx)("div",{className:t,children:Object(b.jsx)("div",{className:"alternate__container",children:Object(b.jsx)("div",{children:n})})})}var p=function(){var e,t,n=Object(d.a)({queryKey:["quote"],queryFn:function(){return a.apply(this,arguments)}});if(n.isError)return Object(b.jsx)(O,{parentClass:"banner",message:"Error..."});if(n.isLoading)return Object(b.jsx)(O,{parentClass:"banner",message:"Loading..."});function a(){return(a=Object(i.a)(Object(o.a)().mark((function e(){var t;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.get("/query/quote");case 2:return t=e.sent,console.log(t.data),e.abrupt("return",t.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(b.jsxs)("header",{className:"banner",style:{backgroundSize:"cover",backgroundImage:"url(".concat("https://telltale-backend-0tqm.onrender.com/","query/banner)"),backgroundPosition:"center center",backgroundBlendMode:"difference"},children:[Object(b.jsxs)("div",{className:"banner__contents",children:[Object(b.jsx)("div",{className:"banner__buttons",children:Object(b.jsx)("button",{className:"banner__button",children:"My List"})}),Object(b.jsx)("h1",{className:"banner__description",children:(e=n.data.quote,t=250,(null===e||void 0===e?void 0:e.length)>t?e.substr(0,t-1)+"...":e)}),Object(b.jsxs)("h1",{className:"banner__title",children:["- ",n.data.author]})]}),Object(b.jsx)("div",{className:"banner--fadeBottom"})]})},m=n(14),h=n(4),f=(n(36),n(8)),x=n(31),g=(n(96),n(64)),v=Object(g.a)("https://klkotatsmplzawrxyuka.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtsa290YXRzbXBsemF3cnh5dWthIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODY5NDU3NjgsImV4cCI6MjAwMjUyMTc2OH0.Yo80PXvjszZQyBYA9mDo-M4mUjKXK4s1dsc9DVmHw24");function _(e){var t=e.ebook,n=Object(f.n)(),a=function(){var e=Object(i.a)(Object(o.a)().mark((function e(){var n,a,c,r;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id,a=Math.floor(n/1e3),e.next=4,fetch("https://raw.githubusercontent.com/Akil003/TaleTell-static-files/main/".concat(a,"/").concat(n,".webp"));case 4:return c=e.sent,e.next=7,c.blob();case 7:return r=e.sent,e.abrupt("return",URL.createObjectURL(r));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c=Object(d.a)(["image",t],a),r=c.data,s=c.isLoading,l=c.isError;function u(){return u=Object(i.a)(Object(o.a)().mark((function e(t){var a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.auth.getSession();case 2:a=e.sent,console.log("session",a.data),n("/audiobook",{state:{ebook:t,progress:{}.data}});case 6:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}return s||l?Object(b.jsx)(O,{parentClass:"row__poster"}):Object(b.jsxs)("div",{className:"row__poster",onClick:function(){return function(e){return u.apply(this,arguments)}(t)},children:[Object(b.jsx)(x.LazyLoadImage,{className:"poster__image",src:r,alt:t.title,effect:"blur"}),Object(b.jsxs)("div",{className:"poster__details",children:[Object(b.jsx)("div",{className:"poster__title",children:t.title}),Object(b.jsx)("table",{className:"poster__labels",children:Object(b.jsxs)("tbody",{children:[Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:"Authors:"}),Object(b.jsx)("td",{children:t.authors&&t.authors.map((function(e,t){return Object(b.jsxs)("div",{children:[e.first_name," ",e.last_name]},t)}))})]}),t.language&&Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:"Language:"}),Object(b.jsx)("td",{children:t.language})]}),t.totaltimesecs&&Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:"Duration:"}),Object(b.jsx)("td",{children:function(){var e=t.totaltimesecs,n=Math.floor(e/3600),a=Math.floor((e-3600*n)/60);return"".concat(n," hr ").concat(a," mins")}()})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:"Genres:"}),Object(b.jsx)("td",{children:t.genres&&t.genres.map((function(e,t){return Object(b.jsx)("div",{children:e.name},t)}))})]}),t.copyright_year&&Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:"Copyright year:"}),Object(b.jsx)("td",{children:t.copyright_year})]})]})})]})]})}var y=function(e){var t=e.title,n=e.url,a=Object(d.a)({queryKey:["title",n],queryFn:function(){return l.apply(this,arguments)}}),c=a.data,r=a.isError,s=a.isLoading;if(r)return Object(b.jsx)(O,{parentClass:"row__posters",message:"Error..."});if(s)return Object(b.jsx)(O,{parentClass:"row__posters",message:void 0});function l(){return(l=Object(i.a)(Object(o.a)().mark((function e(){var t,a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.get(n);case 2:return t=e.sent,a=(a=t.data).filter((function(e){return e.coverImageURL})),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(b.jsx)("div",{className:"row",children:Object(b.jsxs)(x.LazyLoadComponent,{children:[Object(b.jsx)("h2",{className:"row__title",children:t}),Object(b.jsx)("div",{className:"row__posters",children:c.map((function(e){return Object(b.jsx)(_,{ebook:e},e._id)}))})]})})},k=200;function N(){var e=Object(d.a)({queryKey:["titles"],queryFn:function(){return r.apply(this,arguments)}}),t=e.data,n=e.isError,a=e.isLoading;if(n)return Object(b.jsx)(O,{parentClass:"rows",message:"Error..."});if(a)return Object(b.jsx)(O,{parentClass:"rows",message:"Loading..."});function c(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),a=e[n];e[n]=e[t],e[t]=a}}function r(){return(r=Object(i.a)(Object(o.a)().mark((function e(){var t,n,a,r,s,i,l;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.get("/query/titles");case 2:return t=e.sent,n=t.data,a=n.authors,r=n.genres,s=n.languages,i=n.periods,a=a.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{type:"author"})})),r=r.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{type:"genre"})})),s=s.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{type:"language"})})),i=i.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{type:"period"})})),c(l=[].concat(Object(m.a)(a),Object(m.a)(r),Object(m.a)(s),Object(m.a)(i))),e.abrupt("return",l.slice(0,Math.min(k,l.length)));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(b.jsx)("div",{className:"rows",children:t.map((function(e,t){if("author"===e.type){var n="By ".concat(e._id.firstName," ").concat(e._id.lastName);return Object(b.jsx)(y,{title:n,url:"/query/author/?firstName=".concat(e._id.firstName,"&lastName=").concat(e._id.lastName)},t)}if("language"===e.type){var a="".concat(e._id," Audiobooks");return Object(b.jsx)(y,{title:a,url:"/query/language/?language=".concat(e._id)},t)}if("genre"===e.type){var c="".concat(e._id);return Object(b.jsx)(y,{title:c,url:"/query/genre/?genre=".concat(encodeURIComponent(e._id))},t)}var r;return"period"===e.type?(r="2000"!==e.from?"From ".concat(e.from," to ").concat(e.to):"".concat(e.from," onwards..."),Object(b.jsx)(y,{title:r,url:"/query/period/?from=".concat(e.from,"&to=").concat(e.to)},t)):Object(b.jsx)(b.Fragment,{})}))})}function w(){return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(p,{}),Object(b.jsx)(N,{})]})}var C=n(10);n(100),n(101),n(102),n(103);function I(e){return L.apply(this,arguments)}function L(){return(L=Object(i.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.auth.signInWithOAuth({provider:"google"});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=n(19),M=n.n(E);function q(){var e=Object(a.useState)({}),t=Object(C.a)(e,2),n=t[0],c=t[1],r=Object(a.useState)(!1),s=Object(C.a)(r,2),l=s[0],u=s[1];function j(){return d.apply(this,arguments)}function d(){return(d=Object(i.a)(Object(o.a)().mark((function e(){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(v);case 2:console.log("user",n);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return(O=Object(i.a)(Object(o.a)().mark((function e(){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.auth.signOut();case 2:c({}),console.log("done..."),M.a.set("user","");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){function e(){return e=Object(i.a)(Object(o.a)().mark((function e(){var t,n,a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.auth.getSession();case 2:t=e.sent,n=t.data,a={},console.log(n),n.session&&(a=n.session.user.user_metadata),c(a),M.a.set("email",0===Object.keys(a).length?"":a.email);case 9:case"end":return e.stop()}}),e)}))),e.apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("div",{className:"signin__wrapper",onMouseMove:function(){u(!0)},onMouseLeave:function(){u(!1)},children:[n&&0===Object.keys(n).length&&Object(b.jsx)("button",{id:"siginin__button",className:"signin__button",onClick:j,children:"Sign In"}),n&&Object.keys(n).length>0&&Object(b.jsxs)("div",{className:"signout__wrapper",children:[Object(b.jsx)("button",{className:"signin__profile",style:{backgroundImage:"url(".concat(n.picture,")")},onClick:j}),Object(b.jsx)("button",{className:"signout__button ".concat(l?"signout__visible":""),onClick:function(){return O.apply(this,arguments)},onMouseEnter:function(){u(!0)},onMouseLeave:function(){u(!1)},children:"Sign Out"})]})]})})}var P=function(){var e=Object(a.useState)(!1),t=Object(C.a)(e,2),n=t[0],c=t[1],r=Object(a.useState)(""),s=Object(C.a)(r,2),o=s[0],i=s[1],l=Object(f.n)(),u=function(){window.scrollY>100?c(!0):c(!1)};Object(a.useEffect)((function(){return window.addEventListener("scroll",u),function(){window.removeEventListener("scroll",u)}}),[]);var j=Object(a.useState)(!1),d=Object(C.a)(j,2),O=d[0],p=d[1],m=Object(a.useState)(),h=Object(C.a)(m,2),x=h[0],g=h[1],v=Object(a.useState)(),_=Object(C.a)(v,2),y=_[0],k=_[1];return Object(b.jsxs)("div",{className:"nav ".concat(n&&"nav__black"),children:[Object(b.jsx)("img",{className:"nav__logo",src:"/logo/red-transparent.webp",alt:""}),Object(b.jsxs)("div",{id:"nav_menu",className:"nav__menu ".concat(O?"open":""),onMouseEnter:function(){clearTimeout(x)},onMouseLeave:function(){clearTimeout(x);var e=setTimeout((function(){p(!1)}),100);g(e)},children:[Object(b.jsx)("div",{className:"home__button",onClick:function(){console.log("clicked"),l("/",{state:o})},children:"Home"}),Object(b.jsx)("div",{className:"collections__button",onClick:function(){console.log("clicked"),l("/recommendations",{state:o})},children:"Recommendations"})]}),Object(b.jsxs)("div",{className:"navbar-toggle ".concat(O?"open":""),onClick:function(){console.log("menu toggled..."),p(!O)},onMouseEnter:function(){var e=setTimeout((function(){p(!0)}),100);k(e)},onMouseLeave:function(){clearTimeout(y)},children:[Object(b.jsx)("div",{className:"icon-bar"}),Object(b.jsx)("div",{className:"icon-bar"}),Object(b.jsx)("div",{className:"icon-bar"})]}),Object(b.jsx)("div",{className:"search__wrap",children:Object(b.jsxs)("div",{className:"search",children:[Object(b.jsx)("input",{type:"text",className:"search__term",placeholder:"What are you looking for?",onChange:function(e){i(e.target.value)},onFocus:function(e){e.target.placeholder=""},onBlur:function(e){e.target.placeholder="What are you looking for?"}}),Object(b.jsx)("button",{type:"submit",onClick:function(){l("/search",{state:o})},className:"search__button","aria-label":"search keywords",children:Object(b.jsx)("i",{className:"fa fa-search"})})]})}),Object(b.jsx)(q,{})]})};n(104);function S(){var e=Object(a.useState)([]),t=Object(C.a)(e,2),n=t[0],c=t[1],r=Object(f.l)();return Object(a.useEffect)((function(){function e(){return(e=Object(i.a)(Object(o.a)().mark((function e(){var t,n,a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.state){e.next=3;break}return console.log(r.state),e.abrupt("return");case 3:return t=r.state,e.next=6,j.get("query/search/?keywords=".concat(t));case 6:n=e.sent,a=n.data.filter((function(e){return e.coverImageURL})),c(a);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[r.state]),Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("div",{className:"search__page",children:[Object(b.jsx)("div",{className:"transition"}),Object(b.jsx)("h2",{className:"search__header",children:"Search Results..."}),Object(b.jsx)("div",{className:"search__results",children:n.map((function(e){return Object(b.jsx)(_,{ebook:e},e._id)}))})]})})}n(105);var F=Object(a.createContext)(),R=function(){var e=Object(a.useContext)(F);if(!e)throw new Error("useMediaControlContext must be used within a MediaControlProvider");return e},A=function(e){var t=e.children,n={book:null,index:0,isActive:!1,isPlaying:!1,volume:50,audioRef:Object(a.useRef)(null)},c=Object(a.useState)(n),r=Object(C.a)(c,2),s=r[0],o=r[1],i={mediaControl:s,updateBook:function(e){return o((function(t){return Object(h.a)(Object(h.a)({},t),{},{book:e})}))},updateIndex:function(e){return o((function(t){return Object(h.a)(Object(h.a)({},t),{},{index:e})}))},updateIsActive:function(e){return o((function(t){return Object(h.a)(Object(h.a)({},t),{},{isActive:e})}))},updateIsPlaying:function(e){return o((function(t){return Object(h.a)(Object(h.a)({},t),{},{isPlaying:e})}))},updateVolume:function(e){return o((function(t){return Object(h.a)(Object(h.a)({},t),{},{volume:e})}))}};return Object(b.jsx)(F.Provider,{value:i,children:t})};function B(){var e,t,n,c=Object(f.l)(),r=R(),s=Object(a.useState)(0),l=Object(C.a)(s,2),u=l[0],p=l[1];Object(a.useEffect)((function(){p(0)}),[]);Object(a.useEffect)((function(){p(r.mediaControl.index)}),[r.mediaControl.index]);var m=Object(d.a)({queryKey:["ebook",c.state],queryFn:function(){return c.state}}),h=m.data.ebook,x=m.isError,g=m.isLoading;return Object(a.useEffect)((function(){function e(){return(e=Object(i.a)(Object(o.a)().mark((function e(){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("email",M.a.get("email")),""==M.a.get("email")){e.next=4;break}return e.next=4,j.post("/watched",{email:M.a.get("email"),ebook:{id:h._id,title:h.title}});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[h]),x?Object(b.jsx)(O,{parentClass:"left_wrapper"}):g?Object(b.jsx)(O,{parentClass:"left__wrapper"}):Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("div",{className:"left__wrapper",children:Object(b.jsx)("img",{className:"audiobook__image",src:h.coverImageURL,alt:h.title})}),Object(b.jsxs)("div",{className:"right__wrapper",children:[Object(b.jsx)("div",{className:"section__title",children:Object(b.jsx)("h2",{children:null===(e=h.sections[u])||void 0===e?void 0:e.title})}),Object(b.jsx)("div",{className:"big__play__wrapper",children:Object(b.jsx)("a",{className:"big__play__button ".concat(r.mediaControl.isPlaying&&r.mediaControl.book==h&&"playing"),onClick:function(){r.mediaControl.isActive||r.updateIsActive(!0),h==r.mediaControl.book?(r.updateIsPlaying(!r.mediaControl.isPlaying),r.updateIndex(r.mediaControl.index)):(r.updateBook(h),r.updateIsPlaying(!0),r.updateIndex(0)),console.log("media control updated from BigPoster",h)},children:r.mediaControl.isPlaying&&r.mediaControl.book==h?"Pause":"Play"})}),Object(b.jsx)("div",{className:"audiobook__details",children:Object(b.jsx)("table",{className:"audiobook__labels",children:Object(b.jsxs)("tbody",{children:[Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:"Authors:"}),Object(b.jsx)("td",{children:null===(t=h.authors)||void 0===t?void 0:t.map((function(e,t){return Object(b.jsxs)("div",{children:[e.first_name," ",e.last_name]},t)}))})]}),h.language&&Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:"Language:"}),Object(b.jsx)("td",{children:h.language})]}),h.totaltimesecs&&Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:"Duration:"}),Object(b.jsx)("td",{children:function(){var e=h.totaltimesecs,t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60);return"".concat(t," hr ").concat(n," mins")}()})]}),Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:"Genres:"}),Object(b.jsx)("td",{children:null===(n=h.genres)||void 0===n?void 0:n.map((function(e,t){return Object(b.jsx)("div",{children:e.name},t)}))})]}),h.copyright_year&&"0"!==h.copyright_year&&Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:"Copyright year:"}),Object(b.jsx)("td",{children:h.copyright_year})]})]})})})]})]})}var U=n(60),z=(n(115),n(35)),T=n(0),J=function(){var e=R();return Object(b.jsxs)("div",{className:"play-pause-wrapper",children:[Object(b.jsx)("label",{htmlFor:"checkbox",className:"button-label",children:Object(b.jsx)("div",{className:"playPauseIcon ".concat(e.mediaControl.isPlaying?"pause":"play")})}),Object(b.jsx)("input",{type:"checkbox",id:"checkbox",onChange:function(){e.updateIsPlaying(!e.mediaControl.isPlaying)},className:"hidden-checkbox"})]})},K=function(e){if(!e)return"00:00:00";var t=Math.floor(e/3600),n=Math.floor(e/60),a=Math.floor(e%60);return"".concat(String(t).padStart(2,"0"),":").concat(String(n).padStart(2,"0"),":").concat(String(a).padStart(2,"0"))},D=function(){var e,t=R(),n=Object(a.useState)(),c=Object(C.a)(n,2),r=c[0],s=c[1];Object(a.useEffect)((function(){null!=r&&(r.pause(),r.load(),r.play())}),[t.mediaControl.book]),Object(a.useEffect)((function(){console.log("section changed",t),null!=r&&(r.pause(),r.load(),r.play())}),[t.mediaControl.index]),Object(a.useEffect)((function(){var e=t.mediaControl.audioRef.current;s(e)}),[t.mediaControl.audioRef]),Object(a.useEffect)((function(){console.log("is playing",t.mediaControl.isPlaying),null!=r&&(t.mediaControl.isPlaying?r.play():r.pause())}),[t.mediaControl.isPlaying]);var o=Object(a.useState)(0),i=Object(C.a)(o,2),l=i[0],u=i[1],j=Object(a.useState)(1),d=Object(C.a)(j,2),O=d[0],p=d[1];return Object(a.useEffect)((function(){if(null!=r){var e=setInterval((function(){u(r.currentTime)}),1e3);return r.onloadedmetadata=function(){p(r.duration)},function(){clearInterval(e)}}}),[r]),Object(b.jsxs)("div",{className:"audio-player-container",children:[Object(b.jsx)("div",{className:"progress-bar-container",children:Object(b.jsx)("div",{className:"progress-filled",style:{width:"".concat(l/O*100,"%")}})}),Object(b.jsxs)("div",{className:"audio-controls-wrapper",children:[Object(b.jsx)("span",{className:"current-time",children:K(l)}),Object(b.jsxs)("div",{className:"audio-controls",children:[Object(b.jsxs)(T.b.Provider,{value:{size:"2em"},children:[Object(b.jsx)("span",{className:"span-icon",onClick:function(){r.currentTime-=10},children:Object(b.jsx)(z.a,{className:"control-button"})}),Object(b.jsx)("span",{className:"span-icon",children:Object(b.jsx)(z.c,{className:"control-button"})}),Object(b.jsx)(J,{}),Object(b.jsx)("span",{className:"span-icon",children:Object(b.jsx)(z.d,{className:"control-button"})}),Object(b.jsx)("span",{className:"span-icon",onClick:function(){r.currentTime+=10},children:Object(b.jsx)(z.b,{className:"control-button"})})]}),Object(b.jsx)("audio",{autoPlay:!0,ref:t.mediaControl.audioRef,children:Object(b.jsx)("source",{src:t.mediaControl.book.sections&&(null===(e=t.mediaControl.book.sections[t.mediaControl.index])||void 0===e?void 0:e.listen_url),type:"audio/mp3",className:"section__source"})})]}),Object(b.jsx)("span",{className:"total-time",children:K(O)})]})]})},X=function(e){var t=e.section,n=e.index,a=e.book,c=R();return Object(b.jsxs)("div",{className:"audiobook__section ".concat(n==c.mediaControl.index&&"selected"),onClick:function(){return function(e){c.updateIndex(e),c.updateIsPlaying(!0),c.updateBook(a),c.updateIsActive(!0)}(n)},children:[Object(b.jsx)("div",{className:"audiobook__section__title",children:t.title}),Object(b.jsx)("div",{className:"audiobook__section__duration",children:t.duration})]},n)};function Y(){var e=Object(f.l)(),t=Object(d.a)({queryKey:["ebook",e.state],queryFn:function(){return r.apply(this,arguments)}}),n=t.data,a=t.isLoading,c=t.isError;if(a)return Object(b.jsx)(O,{parentClass:"audiobook__page",message:"loading..."});if(c)return Object(b.jsx)(O,{parentClass:"audiobook__page",message:"Error..."});function r(){return(r=Object(i.a)(Object(o.a)().mark((function t(){var n,a,c,r;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("location",e.state),n=e.state,a=n.ebook,c=n.progress,console.log(a,c),console.log("working..."),a||window.history.back(),t.next=7,j.get("query/id?_id=".concat(a._id));case 7:return r=t.sent,a=r.data,t.abrupt("return",{ebook:a,progress:c});case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("div",{className:"audiobook__page",children:[Object(b.jsx)("div",{className:"transition"}),Object(b.jsxs)("div",{className:"audiobook",children:[Object(b.jsx)("h2",{className:"audiobook__header",children:n.ebook.title}),Object(b.jsx)("div",{className:"audiobook__wrapper",children:Object(b.jsx)(B,{})}),Object(b.jsx)("h2",{className:"description__header",children:"Chapters"}),Object(b.jsx)("div",{className:"section__wrapper",children:n.ebook.sections.map((function(e,t){return Object(b.jsx)(X,{section:e,index:t,book:n.ebook},t)}))}),Object(b.jsx)("h2",{className:"description__header",children:"Description"}),n.ebook.description&&Object(b.jsx)("div",{className:"audiobook__description",children:Object(U.a)(n.ebook.description)})]})]})})}var W=u.a.create({baseURL:"https://telltale-recommendation.onrender.com/"});var V=function(e){var t=e.title,n=e.url,a=Object(d.a)({queryKey:["title",n],queryFn:function(){return l.apply(this,arguments)}}),c=a.data,r=a.isError,s=a.isLoading;if(r)return Object(b.jsx)(O,{parentClass:"row__posters",message:"Error..."});if(s)return Object(b.jsx)(O,{parentClass:"row__posters",message:void 0});function l(){return(l=Object(i.a)(Object(o.a)().mark((function e(){var t,a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.get(n);case 2:return t=e.sent,a=(a=t.data).filter((function(e){return e.coverImageURL})),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(b.jsx)("div",{className:"row",children:Object(b.jsxs)(x.LazyLoadComponent,{children:[Object(b.jsx)("h2",{className:"row__title",children:t}),Object(b.jsx)("div",{className:"row__posters",children:c.map((function(e){return Object(b.jsx)(_,{ebook:e},e._id)}))})]})})},Z=20;function G(){var e=Object(d.a)({queryKey:[M.a.get("email")],queryFn:function(){return r.apply(this,arguments)}}),t=e.data,n=e.isError,a=e.isLoading;if(n)return Object(b.jsx)(O,{parentClass:"rows",message:"Error..."});if(a)return console.log("recommendations loading..."),Object(b.jsx)(O,{parentClass:"rows",message:"Loading..."});function c(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),a=e[n];e[n]=e[t],e[t]=a}}function r(){return r=Object(i.a)(Object(o.a)().mark((function e(){var t,n,a,r,s,l,u;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=function(){return l=Object(i.a)(Object(o.a)().mark((function e(t){var n;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W("/?id=".concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)},s=function(e){return l.apply(this,arguments)},""!=(t=M.a.get("email"))){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,j.get("/query/prevWatched/?email=".concat(t));case 7:return n=e.sent,a=n.data,c(r=a.map((function(e){return{id:e.id,title:e.title}}))),r.length>Z&&(r=r.slice(0,Z)),console.log("watched books",r),e.next=15,Promise.all(r.map(function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.title,e.next=3,s(t.id);case 3:return e.t1=e.sent,e.abrupt("return",{title:e.t0,recommendations:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 15:return u=e.sent,console.log("recommendations",u),e.abrupt("return",u);case 18:case"end":return e.stop()}}),e)}))),r.apply(this,arguments)}return console.log("recommendations loaded",t.length),Object(b.jsxs)("div",{className:"rows",children:[""===M.a.get("email")&&Object(b.jsx)(O,{parentClass:"recommendations",message:"Please sign in to get recommendations..."}),""!==M.a.get("email")&&0===t.length&&Object(b.jsx)(O,{parentClass:"recommendations",message:"Please listen to some audiobooks to get recommendations..."}),t.map((function(e,t){return Object(b.jsx)(V,{title:"Because you listened to ".concat(e.title),url:"/query/ids/?ids=[".concat(e.recommendations,"]")},t)}))]})}function H(){return Object(b.jsxs)("div",{className:"recommendations",style:{height:"100vh"},children:[Object(b.jsx)("div",{className:"transition",style:{height:"90px"}}),Object(b.jsx)(G,{})]})}function Q(){var e=R();return Object(b.jsxs)("div",{children:[Object(b.jsx)(P,{}),Object(b.jsxs)(f.c,{children:[Object(b.jsx)(f.a,{path:"/",element:Object(b.jsx)(w,{})}),Object(b.jsx)(f.a,{path:"audiobook",element:Object(b.jsx)(Y,{})}),Object(b.jsx)(f.a,{path:"search",element:Object(b.jsx)(S,{})}),Object(b.jsx)(f.a,{path:"recommendations",element:Object(b.jsx)(H,{})})]}),e.mediaControl.isActive&&Object(b.jsx)(D,{})]})}var $=function(){return Object(b.jsx)("div",{className:"app",children:Object(b.jsx)(A,{children:Object(b.jsx)(Q,{})})})},ee=n(22),te=n(119),ne=n(57),ae=new te.a({defaultOptions:{queries:{enabled:!0,refetchOnMount:!1,refetchOnWindowFocus:!1,refetchIntervalInBackground:2e4,refetchOnReconnect:!1}}});s.a.render(Object(b.jsx)(c.a.StrictMode,{children:Object(b.jsx)(ne.a,{client:ae,children:Object(b.jsx)(ee.a,{children:Object(b.jsx)($,{})})})}),document.getElementById("root"))},36:function(e,t,n){},71:function(e,t,n){},72:function(e,t,n){},92:function(e,t,n){},93:function(e,t,n){},96:function(e,t,n){}},[[116,1,2]]]);
//# sourceMappingURL=main.a3249e9c.chunk.js.map